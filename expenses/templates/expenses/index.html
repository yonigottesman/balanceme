{% block navbar %}{% include 'expenses/navbar.html' %}{% endblock navbar%}

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'expenses/style.css' %}" />

<div class="container ">
  <form action="{% url 'expenses:filter_index' %}" method="post">
    {% csrf_token %}
    <div class="form-row">

      <div class="form-group col-md-3">
        <label for="date">Start Date</label>
        <input type="date" class="form-control" id="startDate" name="startDate" value="{{startDate}}">
      </div>

      <div class="form-group col-md-3">
        <label for="date">End Date</label>
        <input type="date" class="form-control" id="endDate" name="endDate" value="{{endDate}}">
      </div>


      <div class="form-group col-md-3">
        <label for="inputSource">Source</label>
        <select id="source" class="form-control" name="source">
          
          <option value="all">All</option>
          
          {% for source in inputSources %}
          <option  value="{{source.id}}"> {{ source }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group col-md-3">

        <label for="search">Contains Text</label>
        <div class="input-group mb-2">
          {% if search and search != 'None' %}          
          <input type="text" class="form-control" id="search" name="search" value="{{search}}">
          {% else %}
          <input type="text" class="form-control" id="search" name="search">
          {% endif %}
        </div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Filter</button>
  </form>
</div>




{% if transactions %}
<div class="container  ">
  
  <form action="{% url 'expenses:index_action' %}" method="post">
    {% csrf_token %}

    <input name="startDate" type="hidden" value="{{startDate}}" />
    <input name="endDate" type="hidden" value="{{endDate}}" />
    <input name="source" type="hidden" value="{{source}}" />
    <input name="search" type="hidden" value="{{search}}" />

    <div class="row">
      <div class="actions">
        <label>Action: <select name="action" required="">
            <option value="" selected="">---------</option>
            <option value="delete">Delete selected</option>
          </select>
        </label>
        <button type="submit" class="button" title="Run the selected action" name="index" value="0">Go</button>
      </div>
    </div>

    <div class="row  ">
      <table class="table">
        <thead>
          <tr>

            <th><input type="checkbox" onClick="toggle(this)" /></th>
            <th scope="col">Date</th>
            <th scope="col">Merchant</th>
            <th scope="col">Amount</th>
            <th scope="col">Comment</th>
            <th scope="col">Subcategory</th>
            <th scope="col">Source</th>
          </tr>
        </thead>
        <tbody>

          {% for transaction in transactions %}    
          <tr>
            <td><input type="checkbox" value="{{ transaction.id }}" name="marked_checkbox"></td>
            <td>{{ transaction.date }}</td>
            <td>{{ transaction.merchant }}</td>
            <td>{{ transaction.amount }} â‚ª</td>
            <td>{{ transaction.comment }}</td>
            {% if transaction.subcategory%}
            <td>{{ transaction.subcategory }}</td>
            {% else %}
            <td></td>
            {% endif%}
            <td>{{ transaction.source }}</td>
          </tr>
          {% endfor %}

        </tbody>
      </table>
    </div>
  </form>  
</div>



{% else %}
<p>No transactions are available.</p>
{% endif %}






<div class="container">
  <span class="current">
    Page {{ transactions.number }} of {{ transactions.paginator.num_pages }}.
  </span>
  <nav aria-label="...">
    <ul class="pagination">

      {% if transactions.has_previous %}

      <li class="page-item">
        <a class="page-link" href="?page=1&startDate={{startDate}}&endDate={{endDate}}&source={{source}}&search={{search}}" tabindex="-1">First</a>
      </li>
      
      <li class="page-item">
        <a class="page-link" href="?page={{ transactions.previous_page_number }}&startDate={{startDate}}&endDate={{endDate}}&source={{source}}&search={{search}}" tabindex="-1">Previous</a>
      </li>

      {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="#" tabindex="-1">First</a>
      </li>

      <li class="page-item disabled">
        <a class="page-link" href="#" tabindex="-1">Previous</a>
      </li>
      
      {% endif %}
      
      {% if transactions.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ transactions.next_page_number }}&startDate={{startDate}}&endDate={{endDate}}&source={{source}}&search={{search}}">Next</a>
      </li>

      <li class="page-item">
        <a class="page-link" href="?page={{ transactions.paginator.num_pages }}&startDate={{startDate}}&endDate={{endDate}}&source={{source}}&search={{search}}">Last</a>
      </li>
      
      {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="#">Next</a>
      </li>

      <li class="page-item disabled">
        <a class="page-link" href="#">Last</a>
      </li>


      {% endif %}
      
    </ul>
  </nav>
  
</div>

<script language="JavaScript">
    function toggle(source) {
        checkboxes = document.getElementsByName('marked_checkbox');
        for(var i=0, n=checkboxes.length;i<n;i++) {
            checkboxes[i].checked = source.checked;                                            
        }
    }
</script>
